---
title: "cybersecurity_network"
author: "Haleigh Tomlin"
date: "7/21/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(igraph)
library(network)
library(readxl)
library(tidyr)
library(tidyverse)
```

```{r}
cyber <- read_xlsx("Cyber.xlsx")
```

```{r}
cyber
```

```{r}
table(cyber$STW)
```

```{r}
table(cyber$InDemand)
```

```{r}
length(unique(cyber$ONETSOC))
length(unique(cyber$ONETSOCTITLE))
length(unique(cyber$Certification))
```

So, we want to make a network object now.  

What we want to know is how credentials get you from STW to STEM, right?  So maybe in this case, we have the nodes as jobs and the ties as credentials.  Then, the node attributes will be STW vs STEM.

```{r}
cybermat <- cyber %>% select(ONETSOCTITLE, Certification)
cybermat_codes <- cyber %>% select(ONETSOC, Certification)
```

```{r}
dim(cybermat_codes)
```


```{r}
cybermat
```

```{r}
cybermat_attributes1 <- cyber %>% select(name = ONETSOC, STW, Level, InDemand)
cybermat_attributes2 <- cyber %>% select(name = Certification, STW, Level, InDemand)
```


```{r}
cybermat_attributes1 <- cybermat_attributes1[!duplicated(cybermat_attributes1$ONETSOC),]
cybermat_attributes2 <- cybermat_attributes2[!duplicated(cybermat_attributes2$Certification),]
```

```{r}
cybermat_attributes1
cybermat_attributes2
```

```{r}
cybermat_attributes <- rbind(cybermat_attributes1, cybermat_attributes2)
```

```{r}
dim(cybermat_attributes)
table(duplicated(cybermat_attributes))
table(duplicated(cybermat_attributes$name))
```

```{r}
cybermat_attributes <- cybermat_attributes[!duplicated(cybermat_attributes$name),]
```




```{r making an igraph object}
g <- graph.data.frame(cybermat, directed = FALSE)
```

```{r}
print(g, e=TRUE, v=TRUE)
```



```{r, fig.height = 10 cyber graph}
plot(g, vertex.size = 4, vertex.color = "lightblue", edge.color = "black", main = "cyber", vertex.label.degree = -pi/6, vertex.label.cex = 0.5, vertex.label = NA)
```

```{r, fig.height = 10}
plot(g, vertex.size = 3, vertex.color = "lightblue", edge.color = "black", main = "cyber", vertex.label.degree = -pi/6, vertex.label.cex = 0.5, vertex.label = NA, layout = layout_with_kk)
```

So, this is interesting.  We have 2 components, and within cybersecurity it is pretty interconnected.  There are some that have less connections to the center.


```{r, fig.height = 10}
plot(g, vertex.size = 3, vertex.color = "lightblue", edge.color = "black", main = "cyber", vertex.label.degree = -pi/6, vertex.label.cex = 0.5, vertex.label = NA, layout = layout_in_circle)
```

```{r}
table(duplicated(cybermat_codes))
```

```{r}
gsize(g)
vcount(g)
```


```{r}
cybermat_codes <- cybermat_codes[!duplicated(cybermat_codes),]
```

```{r}
dim(cybermat_codes)
```



```{r}
icyber <- graph.data.frame(cybermat_codes, directed = F)
```

V(net)$type <- FALSE
V(net)$type[V(net)$name%in%dat$perpetrator] <- TRUE
proj_net <- bipartite.projection(net)
OR
V(net)$type <- bipartite.mapping(net)$type
proj_net <- bipartite.projection(net)

```{r}
V(icyber)$type <- bipartite.mapping(icyber)$type
icyber.pr <- bipartite.projection(icyber)


#V(icyber)$type[V(icyber)$name %in% cybermat_codes] <- TRUE
#icyber.pr <- bipartite.projection(icyber)
```


```{r, fig.height = 10}
plot(icyber,vertex.shape=ifelse(V(icyber)$type,"circle","square"), vertex.color = ifelse(V(icyber)$type, "green", "red"), vertex.label = NA, vertex.size = 3, main = "cybersecurity affiliation network", directed = F)
```

vertex.label = ifelse(degree(g) > 2, V(g)$label, NA)

```{r, fig.height = 10}
plot(icyber,vertex.color=ifelse(V(icyber)$type,"green","red"), vertex.size = 3, main = "cybersecurity affiliation network", directed = F, layout = layout_with_kk, vertex.label = NA)
```


```{r}
head(cyber)
```

```{r}
cyber <- cyber %>% select(ONETSOCTITLE, Certification, STW, Origin, Certifier, Level, InDemand)
```

```{r}
g_test <- graph.data.frame(cyber, directed = F)
```

```{r}
table(E(g_test)$STW)
```

```{r}
V(g_test)$type <- bipartite.mapping(g_test)$type
g_test.pr <- bipartite.projection(g_test)
```

```{r, fig.height = 20}
plot(g_test,vertex.shape=ifelse(V(g_test)$type,"circle","square"), vertex.color = ifelse(V(g_test)$type, "green", "red"), edge.color = ifelse(E(g_test)$STW == "STW", "orange", "black"), vertex.label = ifelse(V(g_test)$type == F, V(g_test)$name, NA), vertex.label.degree = -pi/10, vertex.label.cex = .3, vertex.label.dist = 0, vertex.label.color = "black", vertex.size = 3, main = "cybersecurity affiliation network", directed = F)
```

